{"version":3,"sources":["webpack:///./src/views/login/index.vue?3a76","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?e0c5","webpack:///./src/views/login/index.vue","webpack:///./src/api/user.js","webpack:///./src/views/login/index.vue?9e23"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","model","value","user","callback","$$v","$set","expression","slot","isCountDownShow","onCodeShow","_v","login","staticRenderFns","data","mobile","code","methods","component","getSmsCode","request","url","method","onlogin","getUserInfo","getUserById","userId","addFollow","target","deleteFollow","getUserProfile","updateUserPhoto","updateUserProfile","getUserCollect","getUserArticle","getUserHistory"],"mappings":"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","file":"js/chunk-026efb72.875aad77.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login-container\"},[_c('van-nav-bar',{attrs:{\"title\":\"注册/登录\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('ValidationObserver',{ref:\"form\"},[_c('ValidationProvider',{attrs:{\"name\":\"手机号\",\"rules\":\"required|mobile\",\"immediate\":\"\"}},[_c('van-field',{attrs:{\"clearable\":\"\",\"placeholder\":\"请输入手机号\"},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}},[_c('i',{staticClass:\"icon icon-mobile\",attrs:{\"slot\":\"left-icon\"},slot:\"left-icon\"})])],1),_c('ValidationProvider',{attrs:{\"name\":\"验证码\",\"rules\":\"required|code\",\"immediate\":\"\"}},[_c('van-field',{attrs:{\"placeholder\":\"请输入验证码\"},model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}},[_c('i',{staticClass:\"icon icon-lock\",attrs:{\"slot\":\"left-icon\"},slot:\"left-icon\"}),(_vm.isCountDownShow)?_c('van-count-down',{attrs:{\"slot\":\"button\",\"time\":1000*5,\"format\":\"ss s\"},on:{\"finish\":function($event){_vm.isCountDownShow=false}},slot:\"button\"}):_c('van-button',{attrs:{\"slot\":\"button\",\"size\":\"small\",\"type\":\"primary\"},on:{\"click\":_vm.onCodeShow},slot:\"button\"},[_vm._v(\"发送验证码\")])],1)],1)],1),_c('div',{staticClass:\"login-btn\"},[_c('van-button',{attrs:{\"type\":\"info\"},on:{\"click\":_vm.login}},[_vm._v(\"登录\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"login-container\">\n\n    <van-nav-bar title=\"注册/登录\" left-arrow\n      @click-left=\"$router.back()\"/>\n\n    <ValidationObserver ref=\"form\">\n    <!-- <van-field clearable placeholder=\"请输入手机号\" v-model=\"user.mobile\" class=\"icon icon-mobile\"> -->\n      <ValidationProvider name='手机号' rules='required|mobile' immediate>\n        <van-field clearable placeholder=\"请输入手机号\" v-model=\"user.mobile\" >\n        <i class=\"icon icon-mobile\" slot='left-icon'></i>\n        <!-- <van-icon class-prefix=\"icon\" name=\"icon-mobile\" /> -->\n        </van-field>\n        <!-- <span>{{ errors[0] }}</span> -->\n      </ValidationProvider>\n\n      <ValidationProvider name='验证码' rules='required|code' immediate>\n        <van-field placeholder=\"请输入验证码\" v-model=\"user.code\">\n          <i class=\"icon icon-lock\" slot='left-icon'></i>\n          <van-count-down :time=\"1000*5\" format=\"ss s\" slot=\"button\" v-if=\"isCountDownShow\" @finish='isCountDownShow=false'/>\n          <van-button slot=\"button\" size=\"small\" type=\"primary\" v-else @click=\"onCodeShow\">发送验证码</van-button>\n        </van-field>\n      </ValidationProvider>\n    </ValidationObserver>\n\n    <div class=\"login-btn\">\n      <van-button type=\"info\" @click='login'>登录</van-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { getSmsCode, onlogin } from '@/api/user.js'\nimport { validate } from 'vee-validate'\nexport default {\n  data () {\n    return {\n      user: {\n        mobile: '',\n        code: ''\n      },\n      isCountDownShow: false\n    }\n  },\n  methods: {\n    async login () {\n      // 1 获取表单数据\n      const user = this.user\n      // 2 校验手机号和验证码\n      let success = await this.$refs.form.validate()\n      if (!success) {\n        // 获取错误信息,请提示\n        // console.log('验证失败')\n        // console.log(this.$refs.form.errors)\n        let errors = this.$refs.form.errors\n        for (const key in errors) {\n          const item = errors[key]\n          if (item[0]) {\n            this.$toast(item[0])\n            return\n          }\n        }\n      }\n      // 3 获取接口 发送请求\n      this.$toast.loading({\n        message: '加载中...',\n        forbidClick: true,\n        duration: 0\n      })\n      try {\n        const { data } = await onlogin(user)\n        // 将登陆成功获取的token相关信息储存到vuex中\n        this.$store.commit('onSetItem', data.data)\n        this.$toast.success('登录成功')\n        // 跳转到原来页\n        const redirect = this.$route.query.redirect || '/'\n        this.$router.push(redirect)\n      } catch (error) {\n        this.$toast.fail('登录失败')\n      }\n      // 4 后续任务\n    },\n\n    async onCodeShow () {\n      try {\n        //   1 验证手机号\n        const { mobile } = this.user\n        let validateMobile = await validate(mobile, 'required|mobile', {\n          name: '手机号'\n        })\n        if (!validateMobile.valid) {\n          console.log(validateMobile)\n          this.$toast(validateMobile.errors[0])\n          return\n        }\n        //   2 显示倒计时\n        this.isCountDownShow = true\n        //   3 获取接口\n        await getSmsCode(mobile)\n      } catch (error) {\n        this.isCountDownShow = false\n        this.$toast('请勿频繁操作')\n      }\n    }\n  }\n}\n</script>\n\n<style lang='less' scoped>\n.login-container {\n  .login-btn {\n    margin: 27px 16px;\n    .van-button {\n      width: 100%;\n      background-color: #6db4fb;\n    }\n  }\n  .van-button{\n      background-color: #6db4fb;\n  }\n  .van-cell{\n      align-items: center;\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=3cc1f822&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=3cc1f822&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3cc1f822\",\n  null\n  \n)\n\nexport default component.exports","import request from '@/utils/request'\n// 获取验证码\nexport const getSmsCode = mobile => {\n  return request({\n    url: `/app/v1_0/sms/codes/${mobile}`,\n    method: 'GET'\n  })\n}\n// 用户登录\nexport const onlogin = data => {\n  return request({\n    url: '/app/v1_0/authorizations',\n    method: 'POST',\n    data\n  })\n}\n// 获取当前用户信息\nexport const getUserInfo = () => {\n  return request({\n    url: '/app/v1_0/user',\n    method: 'GET'\n  })\n}\n\n// 获取指定用户信息\nexport const getUserById = userId => {\n  return request({\n    url: `/app/v1_0/users/${userId}`,\n    method: 'GET'\n  })\n}\n\n// export const addFollow = target => {\n//   return request({\n//     url: '/app/v1_0/user/followings',\n//     method: 'POST',\n//     data: {\n//       target\n//     }\n//   })\n// }\n\n// 关注\nexport const addFollow = userId => {\n  return request({\n    method: 'POST',\n    url: '/app/v1_0/user/followings',\n    data: {\n      target: userId\n    }\n  })\n}\n\nexport const deleteFollow = userId => {\n  return request({\n    url: `/app/v1_0/user/followings/${userId}`,\n    method: 'DELETE'\n  })\n}\n\n// 获取用户信息\nexport const getUserProfile = () => {\n  return request({\n    url: '/app/v1_0/user/profile',\n    method: 'GET'\n  })\n}\n\nexport const updateUserPhoto = data => {\n  return request({\n    url: '/app/v1_0/user/photo',\n    method: 'PATCH',\n    data\n  })\n}\n\n// 编辑用户个人资料\nexport const updateUserProfile = data => {\n  return request({\n    url: '/app/v1_0/user/profile',\n    method: 'PATCH',\n    data\n  })\n}\n\n// 获取用户收藏列表\nexport const getUserCollect = data => {\n  return request({\n    url: '/app/v1_0/article/collections',\n    method: 'GET',\n    data\n  })\n}\n\n// 获取用户文章列表\nexport const getUserArticle = data => {\n  return request({\n    url: '/app/v1_0/user/articles',\n    method: 'GET',\n    data\n  })\n}\n\n// 获取用户阅读历史\nexport const getUserHistory = data => {\n  return request({\n    url: '/app/v1_0/user/histories',\n    method: 'GET',\n    data\n  })\n}\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=3cc1f822&lang=less&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=3cc1f822&lang=less&scoped=true&\""],"sourceRoot":""}